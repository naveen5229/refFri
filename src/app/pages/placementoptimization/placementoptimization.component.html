<nb-card style="border: 0px;">
  <nb-card-header>
    <div class="row">
      <div class="col-sm-6 p-0">
        <h5>Placement Optimization</h5>
      </div>

      <div class="col-sm-2 col-sm-offset-1 constraints" (click)="placementReq()">Placement Requirement</div>
      <div class="col-sm-2 col-sm-offset-1 constraints"  (click)="constraints()">Placement Constraints</div>
    </div>
  </nb-card-header>
  <nb-card-body>
    <div class="row">
      <div class="col-sm-12">
      <label style="float: right;" [ngClass]="isVisible ? 'red' : 'green'" [(ngModel)]="showHides"
        (click)="showHide(isVisible)">{{showHides}}</label>
      </div>
    </div>

    <div *ngIf="isVisible">
      <div class="row">
        <div class="col-sm-12 p-0">
          <div class="col-sm-3">
            <label>Placement Date</label>
            <uj-date-time-picker (onChanged)="getDate($event);" [isTime]='false' [dateTimeValue]="placementDate">
            </uj-date-time-picker>
          </div>
          
          <div class="col-sm-2">
            <label>Select Days</label><br>
            <select [(ngModel)]="days" (change)="selectDays($event);" style="width:100%">
              <option value="1">Today</option>
              <option value="2">(Today+1)</option>
              <option value="3">(Today+2)</option>
              <option value="4">(Today+3)</option>
              <option value="5">(Today+4)</option>
            </select>
          </div>

          <div class="col-sm-3 mt-4">
            <label><input name="time" [(ngModel)]="select" type="radio" [value]="0">Include All</label>
            <label><input name="time" class="ml-3" type="radio" [(ngModel)]="select" [value]="1">Only Available</label>
          </div>

          <div class="col-sm-2">
            <label>Quantity Type:</label>
                <select [(ngModel)]="quantityType" style="width:100%;padding:4.5px!important;border: 1px solid lightgrey!important;border-radius:5px;">
                    <option [value]="0">Capacity</option>
                    <option [value]='1'>Vehicle</option>
                </select> 
          </div>

          <div class="col-sm-2">
            <button class="btn btn-primary mt-2" (click)="fillingFields($event, 1)">Manual Fill</button>
            <button class="btn btn-primary mt-2" (click)="fillingFields($event, 2)">Auto Fill</button>
            <button class="btn btn-primary mt-2" (click)="resetFields()">Reset</button>

          </div>
        </div>
      </div>

      <div class="row mt-3" style="width:100%;overflow-x:scroll;">
        <div class="col-sm-12 p-0">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th><label>Plant</label></th>
                <th><label>Day</label></th>
                <th><label>Waiting Time</label></th>
                <th><label>Min Quantity</label></th>
                <th><label>Max Quantity</label></th>
                <th><label>Min Penalty</label></th>
                <th><label>Max Penalty</label></th>
                <th style="min-width:140px;"><label>Onwards 24 Hours</label></th>
                <th style="min-width:80px;"><label >At Plant</label></th>
                <th><label>Towards</label></th>
                <th><label>Action</label></th>
              </tr>
            </thead>
            <tbody>

              <tr *ngFor="let item of items; let j= index">
                <td style="min-width: 250px;">
                  <auto-suggestion (onSelected)="selectplnt($event, j);" url="suggestion/getSites" display="name"
                    placeholder="Search Plant" [preSelected]="(item.siteId>0) ? {'name':item.siteName} : {'name':null}">
                  </auto-suggestion>
                </td>
                <td style="min-width:154px;">
                  <span [ngStyle]="{'color':item['dayIndex']==1 ? 'green':(item['dayIndex']==2?'red':(item['dayIndex']==3?'blue':(item['dayIndex']== 4 ?'orange':'black')))}">
                    {{item['dayIndex']==1 ? "(Today)":(item['dayIndex']==2 ? "(Today+1)":(item['dayIndex']==3 ? "(Today+2)":(item['dayIndex']== 4 ? "(Today+3)":"(Today+4)")))}}</span>
                </td>
                <td>
                  <input type="number" [(ngModel)]="item.waitingTime" min=0 oninput="validity.valid||(value='');"
                    class="form control" placeholder="Waiting Time">
                </td>

                <td>

                  <input type="number" [(ngModel)]="item.minQuantity" min=0 oninput="validity.valid||(value='');"
                    class="form control" placeholder="Min Qty">
                </td>

                <td>
                  <input type="number" [(ngModel)]="item.maxQuantity" min=0 oninput="validity.valid||(value='');"
                    class="form control" placeholder="Max Qty">
                </td>

                <td>

                  <input type="number" [(ngModel)]="item.penaltyMin" min=0 oninput="validity.valid||(value='');"
                    class="form control" placeholder="Min Panalty">
                </td>

                <td>
                  <input type="number" [(ngModel)]="item.penaltyMax" min=0 oninput="validity.valid||(value='');"
                    class="form control" placeholder="Max Panalty">
                </td>

                <td>
                    <label>{{item.onward24Hrs}}</label>
                </td>

                <td>
                    <label>{{item.atPlant}}</label>
                </td>

                <td>
                    <label>{{item.towards}}</label>
                </td>

                <td style="padding: 0px;">
                  <span><i class="fa fa-plus add" (click)="addMoreItems(i)" *ngIf="j == items.length-1" style="padding: 1px;
                                color: green;"></i>
                    <i class="fa fa-minus minus" (click)="items.splice(j,1)" *ngIf="j !== 0" style="padding: 1px;
                              color: red;"></i>
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-sm-12 mb-2">
          <div class="col-sm-2">
            <button class="btn btn-primary" (click)="savePlacementOptimization()">submit</button>
          </div>
        </div>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-sm-12" style="text-align:center;" *ngIf="placementOPT">
        <label style="float:right;" [ngClass]="isActive ? 'red' : 'green'" [(ngModel)]="tblshowhide"
        (click)="tblShowHides(isActive)">{{tblshowhide}}</label>
      </div>
      <table *ngIf="placementOPT && isActive" class="table table-bordered">
        <tr style="background-color:#78cfea;">
          <th>#</th>
          <th>Site Id</th>
          <th>Name</th>
          <th>Min Quantity</th>
          <th>Max Quantity</th>
          <th>Allocated Vehicle</th>
          <th> Onwards 24 Hrs</th>
          <th> At Parking </th>
          <th> Towards</th>
        </tr>
        <tr *ngFor="let packet of placementOPT.siteAllocationDetails;let i=index">
          <td>{{i+1}}</td>
          <td>{{packet.siteId}}</td>
          <td>{{packet.name}}</td>
          <td>{{packet.minQuantity}}</td>
          <td>{{packet.maxQuantity}}</td>
          <td>{{packet.allocatedVehicles}}</td>
          <td>{{packet.onward24Hrs}}</td>
          <td>{{packet.atPlant}}</td>
          <td>{{packet.towards}}</td>
        </tr>
      </table>
    
    </div>

    <div *ngIf="placementOPT">
      <table class="table table-bordered">
        <thead>
          <tr><th class="ttl">Total Cost</th><th class="ttl grn">{{totalCost}}</th><th class="ttl">Total penalty</th><th class="ttl grn">{{totalPanelty}}</th>
            <th><i class="fa fa-map grn"  (click)="showAllData(placementOPT)"></i></th>
          </tr>
        </thead>
      </table>
      <div class="row" style="height:60vh;overflow-y:auto;">
        <table class="table table-bordered" *ngFor="let packet of placementOPT.siteVehicleCostPackets;let i = index; let active = false">
          <thead>
            <tr>
              <th colspan='4' class="col-sm-11 hdStyle">
                <span>Plant:</span><span class="ml-2 grn">{{packet.siteName}} </span>
                
               <span class="ml-4">Cost:</span> 
               <span class="ml-2 grn">{{packet.totalCost}}</span>
               <span class="ml-4">Penalty:</span>
               <span class="ml-2 grn">{{packet.totalPenalty}}</span>
              </th>
              <th class="col-sm-1 hdStyle">
                <i class="fa fa-map grn"  (click)="showDataOnMap(packet.vehicleCostPacket,packet.siteLatitude,packet.siteLongitude,packet.siteName)"></i>
                <i class="fa fa-plus ml-3 grn" *ngIf="!packet.active" (click)="packet.active = !packet.active"></i>
                <i class="fa fa-minus ml-3 rd"  *ngIf="packet.active" (click)="packet.active = !packet.active"></i>
              </th>
            </tr>
            <tr style="background-color:#78cfea;">
              <th style="width:10%;">#</th>
              <th style="width:22%;">Vehicle Id</th>
              <th style="width:22%;">Reg No</th>
              <th style="width:22%;">Cost</th>
              <th style="width: 22%;">Penalty</th>
            </tr>
          </thead>

          <tbody *ngIf="packet.vehicleCostPacket.length > 0 && packet.active">
            <tr *ngFor="let costPacket of packet.vehicleCostPacket;let i = index;">
              <td style="width:10%;max-width: 50px;">{{i+1}}</td>
              <td style="width:30%;">{{costPacket.vehicleId}}</td>
              <td style="width:30%;">{{costPacket.truckRegno}}</td>
              <td style="width:30%;">{{costPacket.cost}}</td>
              <td style="width:30%;">{{costPacket.penalty}}</td>
            </tr>
          </tbody>
          <tbody *ngIf="!packet.vehicleCostPacket.length">
            <tr>
              <td colspan="4" class="noRecord">No Record Found!</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </nb-card-body>
</nb-card>