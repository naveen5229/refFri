<!-- Author : Prashant Sharma -->
<div class="modal-header">
  <h5>Generate Dispatch Order</h5>
  <button type="button" class="close" aria-label="Close" (click)="closeModal()">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<nb-card>
  <nb-card-body class="m-0 p-0" (keydown)="common.enterHandler($event)">
    <div class="modal-body clearfix">
      <div [class]="img_flag?'col-md-7':'col-md-12'">

        <!-- general Data -->
        <table class="table table-bordered gerrate_tabel gr-lr-form" style="width:100%">

          <!-- fixed Data -->
          <tr>
            <td>
              <label>Vehicle<span style="color: red">*</span></label>
              <span>
                <auto-suggestion (onSelected)="getVehicleInfo($event)" url="Vehicles/getVehicleListForFoid"
                  display="regno" placeholder="Enter Vehicle Number" (change)="resetVehicle()" inputId="vehicleno"
                  [preSelected]="{regno : vehicleData.regno }" style="width
                  :100%">
                </auto-suggestion>
              </span>
            </td>
            <td>
              <label>Branch</label>
              <span>
                <select class="form-control" [(ngModel)]="accountService.selected.branch.id"
                  (change)="getDispatchOrderFields();">
                  <option *ngFor="let branch of accountService.branches" [value]="branch.id">{{branch.name}}</option>
                </select>
              </span>
            </td>
          </tr>
          <tr>
            <td>
              <label>Date<span style="color: red">*</span></label>
              <span>
                <uj-date-time-picker (onChanged)="disOrder.date = $event" [dateTimeValue]="disOrder.date"
                  [isTime]="false" class="col-6">
                </uj-date-time-picker>
              </span>
            </td>
            <td></td>
          </tr>

          <!-- ordered Data -->
          <tr *ngFor=" let dd of generalDetailColumn1 ; let i=index; ">

            <!-- first column -->
            <td *ngIf=" generalDetailColumn1[i] && generalDetailColumn1[i].r_coltitle">

              <!-- field Title -->
              <label>{{generalDetailColumn1[i].r_coltitle}}<span style="color: red"
                  *ngIf="generalDetailColumn1[i].r_required">*</span></label>
              <span>

                <!-- Company suggestion -->
                <auto-suggestion *ngIf="generalDetailColumn1[i].r_colname == 'party_name'"
                  (onChange)="generalDetailColumn1[i].r_valueid = ''"
                  (onSelected)="generalDetailColumn1[i].r_value = $event.name;generalDetailColumn1[i].r_valueid = $event.id ; getCompanyData(generalDetailColumn1[i].r_colname,$event)"
                  url="Suggestion/GetCompanies" display="name" placeholder=" Search Name"
                  [preSelected]="{name:generalDetailColumn1[i].r_value}" class="auto-suggest">
                </auto-suggestion>
                <i *ngIf="generalDetailColumn1[i].r_colname == 'party_name'" class="fa fa-plus add"
                  (click)="addCompany()"></i>

                <!-- Driver Name suggestion -->
                <auto-suggestion *ngIf="generalDetailColumn1[i].r_colname == 'driver_name'"
                  (onChange)="generalDetailColumn1[i].r_valueid = ''"
                  (onSelected)="getDriverInfo($event, generalDetailColumn1[i]);generalDetailColumn1[i].r_valueid = $event.id"
                  url="Booster/getDrivers" display=mobileno placeholder="Select Driver" class="auto-suggest d-block"
                  [preSelected]="generalDetailColumn1[i].r_value ? {mobileno: generalDetailColumn1[i].r_value , empname:''} : {mobileno: '', empname:''}"
                  placeholder="Search Driver">
                </auto-suggestion>
                <i class="fa fa-plus add " *ngIf="generalDetailColumn1[i].r_colname == 'driver_name'"
                  (click)="addDriver()"></i>

                <input type="text" class="form-control" [(ngModel)]=generalDetailColumn1[i].r_value
                  *ngIf="generalDetailColumn1[i].r_colname == 'driver_mobile'" [id]='generalDetailColumn1[i].r_colname'
                  readonly>

                <!-- Simple text Box -->
                <input type="text" class="form-control" [(ngModel)]=generalDetailColumn1[i].r_value *ngIf="generalDetailColumn1[i].r_colname != 'regno' && generalDetailColumn1[i].r_colname != 'lr_date' 
                  && generalDetailColumn1[i].r_colname != 'driver_mobile'  && generalDetailColumn1[i].r_colname != 'driver_name' 
                  && generalDetailColumn1[i].r_colname != 'party_name'" [id]='generalDetailColumn1[i].r_colname'>
              </span>
            </td>


            <!-- second Column -->
            <td *ngIf="generalDetailColumn2[i] && generalDetailColumn2[i].r_coltitle">

              <!-- field Title -->
              <label>{{generalDetailColumn2[i].r_coltitle}}<span style="color: red"
                  *ngIf="generalDetailColumn2[i].r_required">*</span></label>

              <span>

                <!-- Company suggestion -->
                <auto-suggestion (onChange)="generalDetailColumn2[i].r_valueid = ''"
                  *ngIf="generalDetailColumn2[i].r_colname == 'party_name'"
                  (onSelected)="generalDetailColumn2[i].r_value = $event.name;generalDetailColumn2[i].r_valueid = $event.id;getCompanyData(generalDetailColumn2[i].r_colname,$event)"
                  url="Suggestion/GetCompanies" display="name" placeholder=" Search Name"
                  [preSelected]="{name : generalDetailColumn2[i].r_value}" class="auto-suggest">
                </auto-suggestion>
                <i *ngIf="generalDetailColumn2[i].r_colname == 'party_name'" class="fa fa-plus add"
                  (click)="addCompany()"></i>

                <!-- Driver Name suggestion -->
                <auto-suggestion *ngIf="generalDetailColumn2[i].r_colname == 'driver_name'"
                  (onChange)="generalDetailColumn2[i].r_valueid = ''"
                  (onSelected)="getDriverInfo($event, generalDetailColumn2[i]);generalDetailColumn2[i].r_valueid = $event.id"
                  url="Booster/getDrivers" display=mobileno placeholder="Select Driver" class="auto-suggest"
                  [preSelected]="generalDetailColumn2[i].r_value ? {mobileno: generalDetailColumn2[i].r_value,empname : ''} : {mobileno: '', empname:''}"
                  placeholder="Search Driver">
                </auto-suggestion>
                <i class="fa fa-plus add " *ngIf="generalDetailColumn2[i].r_colname == 'driver_name'"
                  (click)="addDriver()"></i>
                <input type="text" class="form-control" [(ngModel)]=generalDetailColumn2[i].r_value
                  *ngIf="generalDetailColumn2[i].r_colname == 'driver_mobile'" [id]='generalDetailColumn2[i].r_colname'
                  readonly>

                <!-- Simple text Box -->
                <input type="text" class="form-control" [(ngModel)]=generalDetailColumn2[i].r_value *ngIf="generalDetailColumn2[i].r_colname != 'regno' && generalDetailColumn2[i].r_colname != 'lr_date'
                  && generalDetailColumn2[i].r_colname != 'driver_mobile'  && generalDetailColumn2[i].r_colname != 'driver_name'
                  && generalDetailColumn2[i].r_colname != 'party_name' " [id]='generalDetailColumn2[i].r_colname'>

              </span>
            </td>
          </tr>
        </table>

        <div><button class="btn btn-primary" (click)=saveDetails()>{{btnTxt}}</button></div>

      </div>

    </div>
  </nb-card-body>
</nb-card>